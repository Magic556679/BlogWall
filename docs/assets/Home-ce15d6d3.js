import{A as B,u as L,d as P,b as y,e as E,o as a,c,F as v,f as x,g as u,h as e,t as p,i as K,n as M,w as $,v as D,j as A,k as N,a as C}from"./index-1284e9c4.js";import{p as k,_ as z}from"./Aside.vuevuetypescriptsetuptruelang-3c5bd669.js";import{c as F,A as T,a as q,f as G}from"./post-98dcbc09.js";let H=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((t,r)=>(r&=63,r<36?t+=r.toString(36):r<62?t+=(r-26).toString(36).toUpperCase():r>62?t+="-":t+="_",t),"");const b=n=>{var t;console.log(n),n instanceof B&&((t=n.response)==null?void 0:t.status)===401&&L().model.openModel(),console.error(n)},I={key:0},R={class:"flex"},W=["src"],J={class:"mt-4"},O=["src"],Q=["onClick"],X={key:0,type:"button"},Y={key:1,type:"button"},Z=e("i",{class:"fa-regular fa-heart cursor-pointer mt-5 mr-2"},null,-1),ee=[Z],se={class:"flex mt-4 items-center"},te=["src"],oe=["onUpdate:modelValue"],re=["onClick"],ne=e("span",null,"留言",-1),le=[ne],ae=["src"],ce={key:1,class:"mt-4 p-6 border-2 border-black rounded-lg"},de=e("p",null,"目前尚無動態，新增一則貼文吧！",-1),ue=[de],ie=P({__name:"StoryWall",props:{data:{type:Array,required:!0}},emits:["getAllPosts"],setup(n,{emit:t}){const r=n,i=L().user,_=y(()=>r.data.map(o=>({...o,uuid:H()}))),h=o=>o.split("T")[0],g=y(()=>i.checkLogin),w=o=>o.includes(i.userId);let f=E([]);const U=async(o,l)=>{try{const s=f[o],m={postId:l,comment:s,user:i.userId};await F(m),f=[],t("getAllPosts")}catch(s){b(s)}},V=(o,l)=>{w(l)?j(o):S(o)},S=async o=>{try{await T({postId:o}),t("getAllPosts")}catch(l){b(l)}},j=async o=>{try{await q({postId:o}),t("getAllPosts")}catch(l){b(l)}};return(o,l)=>n.data.length!==0?(a(),c("div",I,[(a(!0),c(v,null,x(u(_),(s,m)=>(a(),c("div",{key:s.uuid,class:"mt-4 p-6 border-2 border-black rounded-lg"},[e("section",R,[e("img",{class:"w-[45px] h-[45px] mr-4 border-2 border-black rounded-full",src:s.user.photo||u(k),alt:"posterLogo"},null,8,W),e("div",null,[e("p",null,p(s.user.name),1),e("span",null,p(h(s.createAt)),1)])]),e("section",J,[e("p",null,p(s.content),1),s.image?(a(),c("img",{key:0,class:"mt-4",src:s.image},null,8,O)):K("",!0),e("span",{onClick:d=>V(s._id,s.likes)},[u(g)?(a(),c("button",X,[e("i",{class:M(["fa-regular fa-heart cursor-pointer mt-5 mr-2",{"text-red-500":w(s.likes)}])},null,2)])):(a(),c("button",Y,ee))],8,Q),e("span",null,p(s.likes.length||0)+" 個讚",1)]),e("section",se,[e("img",{class:"w-[45px] h-[45px] mr-4 border-2 border-black rounded-full",src:u(g)?u(i).userProfilePhoto:u(k),alt:"loggedInUserLogo"},null,8,te),$(e("input",{"onUpdate:modelValue":d=>u(f)[m]=d,type:"text",placeholder:"請留言",class:"h-10 px-4 rounded-l-lg border-l-2 border-t-2 border-b-2 border-black sm:flex-grow min-w-0"},null,8,oe),[[D,u(f)[m]]]),e("button",{onClick:d=>U(m,s._id),type:"button",class:"h-10 px-2 rounded-r-lg border-2 border-solid border-black text-white bg-[#03438D] whitespace-nowrap"},le,8,re)]),(a(!0),c(v,null,x(s.comments,d=>(a(),c("section",{key:d._id,class:"flex px-4 py-[18px]"},[e("img",{class:"w-[45px] h-[45px] mr-4 border-2 border-black rounded-full",src:d.user.photo||u(k),alt:"commenterLogo"},null,8,ae),e("div",null,[e("div",null,[e("p",null,p(d.user.name),1),e("span",null,p(h(d.createdAt)),1)]),e("div",null,[e("p",null,p(d.comment),1)])])]))),128))]))),128))])):(a(),c("div",ce,ue))}}),pe={class:"flex justify-between sm:mt-12 p-4 sm:p-0"},_e={class:"sm:w-[65%]"},he={class:"flex justify-between"},me={class:"relative grow"},ge=["onKeyup"],fe=e("svg",{class:"w-4 h-4 absolute left-2.5 top-3.5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),ye=P({__name:"Home",setup(n){const t=A([]),r=A(""),i=async()=>{try{const{data:{data:_}}=await G({search:r.value});t.value=_}catch(_){console.error(_)}};return i(),(_,h)=>(a(),c("div",pe,[e("div",_e,[e("div",he,[e("div",me,[$(e("input",{"onUpdate:modelValue":h[0]||(h[0]=g=>r.value=g),onKeyup:N(i,["enter"]),type:"text",class:"p-2 pl-8 w-full rounded-lg border-2 border-solid border-black focus:bg-white focus:outline-none focus:ring-2 focus:ring-yellow-600 focus:border-transparent",placeholder:"搜尋文章內容..."},null,40,ge),[[D,r.value]]),fe])]),e("main",null,[C(ie,{data:t.value,onGetAllPosts:i},null,8,["data"])])]),C(z)]))}});export{ye as default};
